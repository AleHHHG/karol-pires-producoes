<h2 class="mt-5 mb-5">
  Pedidos
  <%= link_icon(new_order_path, 'btn btn-primary float-end', 'fa-solid fa-plus', 'Novo Projeto' ) %>
</h2>

<div class="accordion mb-5">
  <div class="accordion-item">
    <h2 class="accordion-header">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#filters">
        Filtros
      </button>
    </h2>
    <div id="filters" class="accordion-collapse collapse show">
      <div class="accordion-body bg-light">
        <%= form_with url: orders_path, method: :get do |form| %>
          <div class="row">
            <div class="col">
              <%= form.label "Solicitante", class: 'form-label' %>
              <%= form.select :by_owner, Owner.all.collect { |p| [ p.name, p.id ] }, { include_blank: 'Todos', selected: current_scopes[:by_owner] }, { class: 'form-select' }  %>
            </div>
            <div class="col">
              <%= form.label :project, 'Projeto', class: 'form-label' %>
              <%= form.select :by_project, Project.all.collect { |p| [ p.name, p.id ] }, { include_blank: 'Todos', selected: current_scopes[:by_project] }, { class: 'form-select' }  %>
            </div>
            <div class="col">
              <%= form.label :supplier, 'Fornecedor', class: 'form-label' %>
              <%= form.select :by_supplier, Supplier.all.collect { |p| [ p.name, p.id ] }, { include_blank: 'Todos', selected: current_scopes[:by_supplier] }, { class: 'form-select' }  %>
            </div>
          </div>
          <br/>
          <div class="row">
            <div class="col">
                <%= form.label :approver, 'Aprovador', class: 'form-label' %>
                <%= form.select :by_approver, Approver.all.collect { |p| [ p.name, p.id ] }, { include_blank: 'Todos', selected: current_scopes[:by_approver] }, { class: 'form-select' }  %>
            </div>
            <div class="col">
              <%= form.label :status, 'Status', class: 'form-label' %>
              <%= form.select :by_status, [['Solicatado', 'requested'], ['Em andamento', 'in_progress'], ['Concluído', 'done']], {  include_blank: 'Todos', selected: current_scopes[:by_status] }, { class: 'form-select' }  %>
            </div>
          </div>
          <br clear="all"/>
          <%= form.submit "Pesquisar", class: 'btn btn-dark' %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<table class="table table-hover">
  <thead>
    <tr>
      <th>Solicitante</th>
      <th>Projeto</th>
      <th>Fornecedor</th>
      <th>Finalidade</th>
      <th>Data de solictação</th>
      <th>Status</th>
      <th>&nbsp;</th>
    </tr>
  </thead>

  <tbody>
    <% @orders.each do |order| %>
      <tr>
        <td><%= order.owner.name %></td>
        <td><%= order.project.name %></td>
        <td><%= order.supplier.name %></td>
        <td><%= order.note %></td>
        <td><%= order.created_at.strftime('%d/%m/%Y') %></td>
        <td>
          <% if order.requested? %>
            <span class="badge text-bg-secondary">Solicitado</span>
          <% elsif order.in_progress? %>
            <span class="badge text-bg-info">Em andamento</span>
          <% else %>
            <span class="badge text-bg-success">Concluído</span>
          <% end %>
        </td>
        <td>
           <div class="btn-group" role="group">
            <button type="button" class="btn dropdown-toggle btn-md" data-bs-toggle="dropdown" aria-expanded="false">
              Opções
            </button>
            <ul class="dropdown-menu">
              <li><%= link_to 'Detalhes', order_path(order), class: 'dropdown-item' %></li>
              <li><%= link_to 'Editar', edit_order_path(order), class: 'dropdown-item' %></li>
              <li><%= link_to 'Deletar', order, method: :delete, data: { confirm: 'Are you sure?' }, class: 'dropdown-item' %></li>
            </ul>
          </div>
      </tr>
    <% end %>
  </tbody>
</table>
<br clear="all" />

<div class="d-flex justify-content-center mt-2">
  <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>
</div>

<br>
